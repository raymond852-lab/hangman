<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cinnamoroll é»˜å¯«å°å¤©åœ°</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/hanzi-writer@3.5/dist/hanzi-writer.min.js"></script>
    <style>
        :root {
            --cinna-blue: #b3e5fc;
            --cinna-pink: #ffc1e3;
            --soft-bg: #f5fbff;
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: var(--soft-bg);
            color: #5d5d5d; margin: 0; padding: 10px;
            text-align: center; touch-action: manipulation;
        }

        /* é ‚éƒ¨å€åŸŸ */
        .header {
            background: white; border-radius: 25px; padding: 15px;
            margin-bottom: 15px; border: 3px solid var(--cinna-blue);
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        .chibi-img { width: 120px; height: auto; border-radius: 15px; }

        /* ä½¿ç”¨èªªæ˜ */
        .guide-box {
            background: #fff; border-radius: 15px; padding: 10px;
            font-size: 0.85rem; color: #78909c; border: 1px solid var(--cinna-blue);
            margin-bottom: 15px; line-height: 1.5;
        }

        /* è¼¸å…¥å€åŸŸ */
        .input-panel {
            background: white; border-radius: 20px; padding: 15px;
            border: 2px dashed var(--cinna-blue); margin-bottom: 20px;
        }
        #dictation-input {
            width: 90%; border: none; font-size: 1.2rem; outline: none;
            padding: 10px; color: #5d5d5d; text-align: center; border-bottom: 2px solid #eee;
        }
        .btn-row { display: flex; gap: 10px; margin-top: 15px; justify-content: center; }
        .action-btn {
            border: none; padding: 12px 20px; border-radius: 50px; 
            font-weight: bold; cursor: pointer; transition: 0.2s;
        }
        .voice-btn { background: var(--cinna-blue); color: white; }
        .clear-btn { background: #eee; color: #999; }

        /* ç·´ç¿’å€ */
        .word-grid { display: flex; flex-wrap: wrap; justify-content: center; gap: 12px; }
        .word-tile {
            width: 65px; height: 65px; line-height: 65px; font-size: 2.2rem;
            background: white; border: 3px solid var(--cinna-blue); border-radius: 15px;
            cursor: pointer; position: relative;
        }
        .word-tile.completed { border-color: var(--cinna-pink); background: #fff9fb; }
        .word-tile.completed::after { content: 'â­'; position: absolute; top: -12px; right: -5px; font-size: 1.2rem; }

        /* çå‹µåœ–é‘’ */
        .gallery {
            margin-top: 30px; padding: 15px; background: white; border-radius: 20px;
            border: 2px solid var(--cinna-pink);
        }
        .sticker-box { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-top: 10px; }
        .sticker { width: 50px; height: 50px; filter: grayscale(1); opacity: 0.3; transition: 0.5s; }
        .sticker.active { filter: grayscale(0); opacity: 1; transform: scale(1.1); }

        /* å½ˆçª— */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.95); z-index: 1000; justify-content: center; align-items: center;
        }
        .modal-content {
            background: white; width: 85%; max-width: 350px; padding: 25px;
            border-radius: 35px; border: 5px solid var(--cinna-blue); text-align: center;
        }
        #writer-box { background: #fff; margin: 15px auto; border-radius: 20px; border: 2px solid #f0f0f0; }
        .quiz-btn { background: var(--cinna-pink); color: white; font-size: 1.2rem; width: 100%; margin-top: 10px; }
        .speak-btn { background: #e3f2fd; color: #1e88e5; width: 100%; margin-bottom: 10px; }
    </style>
</head>
<body>

    <div class="header">
        <img src="https://img.icons8.com/color/144/cinnamoroll.png" class="chibi-img" alt="Cinnamoroll">
        <h2 style="margin:5px 0; color: #78909c;">ç‰æ¡‚ç‹—é»˜å¯«å°å¤©åœ°</h2>
    </div>

    <div class="guide-box">
        <b>ğŸ’– ä½¿ç”¨èªªæ˜ï¼š</b><br>
        1. é»æ“Š<b>ã€ŒèªéŸ³è¼¸å…¥ã€</b>èªªå‡ºä½ æƒ³ç·´ç¿’çš„è©èª (å»£æ±è©±)ã€‚<br>
        2. é»æ“Šæ–¹å¡Šé–‹å§‹ç·´ç¿’ã€‚å…ˆçœ‹ç­†é †ï¼Œå†æŒ‘æˆ°<b>ã€Œé»˜å¯«ã€</b>ï¼
    </div>

    <div class="input-panel">
        <input type="text" id="dictation-input" placeholder="åœ¨é€™è£¡è¼¸å…¥æ–‡å­—..." />
        <div class="btn-row">
            <button class="action-btn voice-btn" id="start-voice">ğŸ¤ å»£æ±è©±èªéŸ³è¼¸å…¥</button>
            <button class="action-btn clear-btn" onclick="resetApp()">ğŸ—‘ï¸ æ¸…é™¤</button>
        </div>
    </div>

    <div class="word-grid" id="tile-container"></div>

    <div class="gallery">
        <h4 style="margin:0; color:var(--cinna-pink);">ğŸŒ¸ æˆ‘çš„çå‹µåœ–é‘’</h4>
        <p style="font-size:0.7rem; margin:5px 0;">æ¯å­¸æœƒä¸€å€‹å­—ï¼Œå°±æœƒè§£é–ä¸€å€‹è£é£¾å–”ï¼</p>
        <div class="sticker-box" id="sticker-gallery">
            <img src="https://img.icons8.com/color/96/cupcake.png" class="sticker">
            <img src="https://img.icons8.com/color/96/doughnut.png" class="sticker">
            <img src="https://img.icons8.com/color/96/ice-cream-cone.png" class="sticker">
            <img src="https://img.icons8.com/color/96/lollipop.png" class="sticker">
            <img src="https://img.icons8.com/color/96/macaron.png" class="sticker">
            <img src="https://img.icons8.com/color/96/cookie.png" class="sticker">
        </div>
    </div>

    <div id="practice-modal" class="modal">
        <div class="modal-content">
            <button class="action-btn speak-btn" onclick="speakActiveChar()">ğŸ”Š è½è½è®€éŸ³ (å»£æ±è©±)</button>
            <div id="writer-box"></div>
            <button class="action-btn quiz-btn" onclick="startMemoryTest()">ğŸ§  é–‹å§‹é»˜å¯«æŒ‘æˆ°</button>
            <button onclick="closeModal()" style="background:none; border:none; color:#aaa; margin-top:20px; font-weight:bold;">è¿”å›</button>
        </div>
    </div>

    <script>
        let writer = null;
        let activeChar = '';
        let activeTile = null;
        let masterCount = 0;

        // 1. å»£æ±è©±èªéŸ³è¼¸å…¥
        const SpeechRecognition = window.webkitSpeechRecognition || window.SpeechRecognition;
        if (SpeechRecognition) {
            const recognition = new SpeechRecognition();
            recognition.lang = 'zh-HK';
            document.getElementById('start-voice').onclick = () => {
                recognition.start();
                document.getElementById('start-voice').innerText = "æ­£åœ¨è†è½...";
            };
            recognition.onresult = (e) => {
                const text = e.results[0][0].transcript;
                document.getElementById('dictation-input').value = text;
                renderTiles(text);
                document.getElementById('start-voice').innerText = "ğŸ¤ å»£æ±è©±èªéŸ³è¼¸å…¥";
            };
        }

        // 2. å»£æ±è©±æœ—è®€
        function speakActiveChar() {
            const utterance = new SpeechSynthesisUtterance(activeChar);
            utterance.lang = 'zh-HK';
            window.speechSynthesis.speak(utterance);
        }

        // 3. æ¸²æŸ“å­—é«”æ–¹å¡Š
        function renderTiles(text) {
            const container = document.getElementById('tile-container');
            container.innerHTML = '';
            text.split('').forEach(char => {
                if (/[ï¼Œã€‚ï¼ï¼Ÿã€]/.test(char)) return;
                const tile = document.createElement('div');
                tile.className = 'word-tile';
                tile.innerText = char;
                tile.onclick = () => openModal(char, tile);
                container.appendChild(tile);
            });
        }

        // 4. ç·´ç¿’å½ˆçª—
        function openModal(char, tile) {
            activeChar = char;
            activeTile = tile;
            document.getElementById('practice-modal').style.display = 'flex';
            document.getElementById('writer-box').innerHTML = '';
            
            writer = HanziWriter.create('writer-box', char, {
                width: 250, height: 250, padding: 20,
                strokeColor: '#5d5d5d', radicalColor: '#ffc1e3',
                drawingWidth: 25, showOutline: true
            });
            writer.animateCharacter();
        }

        function startMemoryTest() {
            writer.hideOutline();
            writer.quiz({
                onComplete: () => {
                    if (!activeTile.classList.contains('completed')) {
                        activeTile.classList.add('completed');
                        masterCount++;
                        updateGallery();
                    }
                    setTimeout(closeModal, 800);
                }
            });
        }

        // 5. çå‹µç³»çµ±
        function updateGallery() {
            const stickers = document.querySelectorAll('.sticker');
            if (masterCount > 0 && masterCount <= stickers.length) {
                stickers[masterCount - 1].classList.add('active');
            }
        }

        function resetApp() {
            document.getElementById('dictation-input').value = '';
            document.getElementById('tile-container').innerHTML = '';
            masterCount = 0;
            document.querySelectorAll('.sticker').forEach(s => s.classList.remove('active'));
        }

        function closeModal() { document.getElementById('practice-modal').style.display = 'none'; }

        // ç›£æ§æ‰‹å‹•è¼¸å…¥
        document.getElementById('dictation-input').addEventListener('input', (e) => renderTiles(e.target.value));
    </script>
</body>
</html>
