<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç‰æ¡‚ç‹—æ‰‹å¯«å„ªåŒ–ç‰ˆ</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/hanzi-writer@3.5/dist/hanzi-writer.min.js"></script>
    <style>
        :root { --cinna-blue: #b3e5fc; --cinna-pink: #ffc1e3; --bg: #f9feff; }
        body { font-family: 'Noto Sans TC', sans-serif; background-color: var(--bg); margin: 0; padding: 10px; text-align: center; touch-action: manipulation; }
        
        .setup-card { background: white; border-radius: 20px; padding: 20px; border: 2px dashed var(--cinna-blue); max-width: 500px; margin: 0 auto; }
        #dictation-input { width: 90%; border: none; font-size: 1.2rem; border-bottom: 3px solid var(--cinna-blue); margin-bottom: 15px; text-align: center; outline: none; }
        
        /* å¯«å­—è¦–çª—å…¨è¢å¹•å„ªåŒ– */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 1000; flex-direction: column; align-items: center; justify-content: flex-start; padding-top: 20px; }
        
        /* å‹•æ…‹ç•«å¸ƒå®¹å™¨ */
        #canvas-container { 
            width: 90vw; 
            max-width: 350px; 
            aspect-ratio: 1 / 1; 
            border: 8px solid #f0faff; 
            border-radius: 20px; 
            margin: 10px 0; 
            background: #fff;
            box-shadow: 0 4px 15px rgba(179, 229, 252, 0.3);
        }

        .btn-start { background: var(--cinna-pink); color: white; border: none; padding: 15px; border-radius: 50px; width: 90%; font-size: 1.3rem; box-shadow: 0 5px 0 #f06292; font-weight: bold; }
        .history-item { background: #f0faff; padding: 8px; border-radius: 8px; font-size: 0.8rem; margin-bottom: 5px; color: #0288d1; text-align: left; }
    </style>
</head>
<body>

    <div id="setup-page">
        <div class="setup-card">
            <h3 style="color:#546e7a">ç‰æ¡‚ç‹—é»˜æ›¸è€å¸«</h3>
            <input type="text" id="dictation-input" placeholder="éŒ„å…¥èª²æ–‡..." />
            <button class="btn-start" onclick="start()">é–‹å§‹æŒ‘æˆ°</button>
            <div id="history-list" style="margin-top:20px;"></div>
        </div>
    </div>

    <div id="modal" class="modal">
        <div id="phrase-show" style="font-size: 1.5rem; color: #0288d1; font-weight: bold; min-height: 2rem;"></div>
        
        <div id="canvas-container">
            <div id="writer-canvas"></div>
        </div>

        <div style="display:flex; gap: 10px;">
            <button onclick="sayCurrent()" style="font-size: 2rem; background:none; border:none;">ğŸ”Š</button>
            <button onclick="showHint()" style="background:#fffde7; border:1px solid #fbc02d; padding:10px 20px; border-radius:15px; color:#f57f17; font-weight:bold;">ğŸ’¡ æ•‘å‘½è‰</button>
        </div>

        <button id="next-btn" onclick="handleNext()" style="margin-top:20px; background:var(--cinna-pink); color:white; padding:12px 40px; border-radius:30px; border:none; font-size:1.1rem; display:none;">ä¸‹ä¸€æ®µ</button>
        <button onclick="location.reload()" style="margin-top:30px; color:#ccc; border:none; background:none; text-decoration:underline;">çµæŸ</button>
    </div>

    <script>
        let mode = 'ipad'; // æ‰‹æ©Ÿä¸Šé è¨­é€å­—è¾¨è­˜
        let segments = [];
        let currentIdx = 0;
        let writer = null;

        function start() {
            const val = document.getElementById('dictation-input').value.trim();
            if(!val) return;
            segments = val.split(''); // æ‰‹æ©Ÿä¸Šå¼·åˆ¶é€å­—ï¼Œè¾¨è­˜æ›´æº–
            document.getElementById('setup-page').style.display = 'none';
            document.getElementById('modal').style.display = 'flex';
            run();
        }

        function run() {
            const char = segments[currentIdx];
            if (/[ï¼Œã€‚ï¼ï¼Ÿã€\s]/.test(char)) {
                currentIdx++;
                if (currentIdx < segments.length) run();
                else alert("å®Œæˆï¼");
                return;
            }

            // é—œéµï¼šå‹•æ…‹è¨ˆç®—ç•«å¸ƒå¤§å°ä»¥é©æ‡‰æ‰‹æ©Ÿ
            const container = document.getElementById('canvas-container');
            const size = container.offsetWidth - 16; // æ¸›å» border
            document.getElementById('writer-canvas').innerHTML = '';

            writer = HanziWriter.create('writer-canvas', char, {
                width: size,
                height: size,
                padding: 25,
                showOutline: false,
                showCharacter: false,
                strokeColor: '#546e7a',
                // --- å„ªåŒ–æ‰‹æ©Ÿè¾¨è­˜åƒæ•¸ ---
                drawingWidth: 45,       // åŠ ç²—ç­†ç•«ï¼Œæ›´å¥½è¾¨è­˜
                drawingColor: '#333',
                strokeAnimationSpeed: 2,
                delayBetweenStrokes: 50
            });

            sayCurrent();
            writer.quiz({ onComplete: () => { setTimeout(handleNext, 600); } });
        }

        function showHint() { if(writer) writer.showOutline({ duration: 3000 }); }
        function handleNext() {
            currentIdx++;
            if (currentIdx < segments.length) run();
            else location.reload();
        }
        function sayCurrent() {
            const u = new SpeechSynthesisUtterance(segments[currentIdx]);
            u.lang = 'zh-HK'; u.rate = 0.8;
            window.speechSynthesis.speak(u);
        }
    </script>
</body>
</html>
