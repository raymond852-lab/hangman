<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cinnamoroll å­¸ç¿’å°å¤©åœ°</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@500;700&family=Varela+Round&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/hanzi-writer@3.5/dist/hanzi-writer.min.js"></script>
    <style>
        :root {
            --cinna-blue: #b3e5fc;
            --cinna-pink: #ffc1e3;
            --soft-white: #ffffff;
            --text-gray: #5d5d5d;
        }

        body {
            font-family: 'Varela Round', 'Noto Sans TC', sans-serif;
            background-color: #f0faff;
            background-image: radial-gradient(#b3e5fc 1px, transparent 1px);
            background-size: 20px 20px;
            color: var(--text-gray);
            margin: 0; padding: 15px;
            text-align: center;
        }

        /* Header Area */
        .header {
            background: white; border-radius: 30px; padding: 15px;
            box-shadow: 0 5px 15px rgba(179, 229, 252, 0.4);
            margin-bottom: 20px; border: 3px solid var(--cinna-blue);
        }
        .chibi-img { width: 80px; height: auto; }

        /* Input Area */
        .input-box {
            background: white; border-radius: 20px; padding: 15px;
            margin-bottom: 20px; border: 2px dashed var(--cinna-blue);
        }
        #dictation-input {
            width: 100%; border: none; font-size: 1.1rem; outline: none;
            padding: 10px; color: var(--text-gray); text-align: center;
        }

        .voice-btn {
            background: var(--cinna-blue); color: white; border: none;
            padding: 12px 25px; border-radius: 50px; font-weight: bold;
            margin-top: 10px; cursor: pointer; display: flex; align-items: center;
            justify-content: center; gap: 10px; margin-inline: auto;
        }

        /* Word Tiles */
        .study-area {
            display: flex; flex-wrap: wrap; justify-content: center; gap: 15px;
        }
        .word-card {
            background: white; width: 70px; height: 70px; line-height: 70px;
            font-size: 2.2rem; border-radius: 15px; border: 3px solid var(--cinna-blue);
            cursor: pointer; position: relative; transition: 0.3s;
        }
        .word-card.done { border-color: var(--cinna-pink); background: #fff9fb; }
        .word-card.done::after { content: 'ğŸŒ¸'; position: absolute; top: -10px; right: -10px; font-size: 1.2rem; }

        /* Modal Practice */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.9); z-index: 100; justify-content: center; align-items: center;
        }
        .modal-content {
            background: white; width: 90%; max-width: 360px; padding: 25px;
            border-radius: 40px; border: 4px solid var(--cinna-blue); box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        #canvas-container { background: #fff; margin: 20px auto; border-radius: 20px; width: 250px; height: 250px; border: 2px solid #eee; }

        .btn-group { display: flex; flex-direction: column; gap: 10px; }
        .pink-btn { background: var(--cinna-pink); color: white; border: none; padding: 15px; border-radius: 20px; font-size: 1.1rem; font-weight: bold; }
        .blue-btn { background: var(--cinna-blue); color: white; border: none; padding: 12px; border-radius: 20px; }
    </style>
</head>
<body>

    <div class="header">
        <img src="https://i.pinimg.com/originals/18/1e/86/181e868f00673d463a8a370b898971f1.png" class="chibi-img" alt="Cinnamoroll">
        <h2 style="margin:5px 0; color: #78909c;">æˆ‘çš„é»˜å¯«å°å¤©åœ°</h2>
    </div>

    <div class="input-box">
        <input type="text" id="dictation-input" placeholder="é»æ“ŠéŒ„éŸ³æˆ–è¼¸å…¥å–®å­—..." />
        <button class="voice-btn" id="voice-start">
            <span>ğŸ¤</span> å»£æ±è©±èªéŸ³è¼¸å…¥
        </button>
    </div>

    <div class="study-area" id="word-list">
        </div>

    <div id="practice-modal" class="modal">
        <div class="modal-content">
            <div style="font-size: 2rem; color: var(--cinna-blue); font-weight: bold;" id="target-char">å­—</div>
            <div id="canvas-container"></div>
            <div class="btn-group">
                <button class="blue-btn" onclick="writer.animateCharacter()">ğŸ‘€ è§€å¯Ÿç­†é † (Watch)</button>
                <button class="pink-btn" onclick="startQuiz()">ğŸ§  é»˜å¯«æŒ‘æˆ° (Memory Test)</button>
            </div>
            <button onclick="closeModal()" style="background:none; border:none; color:#aaa; margin-top:15px; cursor:pointer;">å–æ¶ˆ</button>
        </div>
    </div>

    <script>
        let writer = null;
        let activeTile = null;
        let speechRecognition = window.webkitSpeechRecognition || window.Recognition;

        // 1. Voice-to-Text (HK Cantonese)
        if (speechRecognition) {
            const recognition = new speechRecognition();
            recognition.lang = 'zh-HK';
            
            document.getElementById('voice-start').onclick = () => {
                recognition.start();
                document.getElementById('voice-start').innerText = "æ­£åœ¨è†è½...";
            };

            recognition.onresult = (event) => {
                const text = event.results[0][0].transcript;
                document.getElementById('dictation-input').value = text;
                document.getElementById('voice-start').innerHTML = "<span>ğŸ¤</span> å»£æ±è©±èªéŸ³è¼¸å…¥";
                generateTiles(text);
            };
        }

        // 2. Tile Generation
        function generateTiles(text) {
            const list = document.getElementById('word-list');
            list.innerHTML = '';
            text.split('').forEach(char => {
                if (/[ï¼Œã€‚ï¼Ÿï¼]/.test(char)) return;
                const div = document.createElement('div');
                div.className = 'word-card';
                div.innerText = char;
                div.onclick = () => openModal(char, div);
                list.appendChild(div);
            });
        }

        // 3. Practice Logic
        function openModal(char, tile) {
            activeTile = tile;
            document.getElementById('practice-modal').style.display = 'flex';
            document.getElementById('target-char').innerText = char;
            document.getElementById('canvas-container').innerHTML = '';
            
            writer = HanziWriter.create('canvas-container', char, {
                width: 250, height: 250, padding: 20,
                strokeColor: '#5d5d5d', radicalColor: '#ffc1e3',
                drawingWidth: 25, showOutline: true
            });
        }

        function startQuiz() {
            writer.hideOutline();
            writer.quiz({
                onComplete: () => {
                    activeTile.classList.add('done');
                    setTimeout(closeModal, 800);
                }
            });
        }

        function closeModal() { document.getElementById('practice-modal').style.display = 'none'; }

        // Allow manual typing too
        document.getElementById('dictation-input').oninput = (e) => generateTiles(e.target.value);
    </script>
</body>
</html>
