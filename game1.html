<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç‰æ¡‚ç‹—è½é»˜æŒ‘æˆ°</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/hanzi-writer@3.5/dist/hanzi-writer.min.js"></script>
    <style>
        :root { --cinna-blue: #b3e5fc; --cinna-pink: #ffc1e3; --bg: #f9feff; }
        body { font-family: 'Noto Sans TC', sans-serif; background-color: var(--bg); margin: 0; padding: 10px; text-align: center; }

        .header { background: white; border-radius: 25px; padding: 15px; border: 3px solid var(--cinna-blue); margin-bottom: 15px; }
        
        /* ä½¿ç”¨ Base64 å…§åµŒåœ–ç‰‡ï¼Œç¢ºä¿æ°¸ä¸ç ´åœ– */
        .hero-img { 
            width: 100px; height: 100px; 
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="60" r="35" fill="white" stroke="%23b3e5fc" stroke-width="2"/><ellipse cx="20" cy="50" rx="15" ry="10" fill="white" stroke="%23b3e5fc" stroke-width="2"/><ellipse cx="80" cy="50" rx="15" ry="10" fill="white" stroke="%23b3e5fc" stroke-width="2"/><circle cx="40" cy="55" r="3" fill="%235d5d5d"/><circle cx="60" cy="55" r="3" fill="%235d5d5d"/><path d="M 45 65 Q 50 70 55 65" fill="none" stroke="%23ffc1e3" stroke-width="2"/></svg>') no-repeat center;
            background-size: contain; margin: 0 auto;
        }

        .mode-selector { display: flex; gap: 10px; margin-bottom: 15px; }
        .mode-btn { flex: 1; padding: 15px; border-radius: 15px; border: 2px solid var(--cinna-blue); background: white; font-weight: bold; }
        .mode-btn.active { background: var(--cinna-blue); color: white; }

        .input-panel { background: white; border-radius: 20px; padding: 20px; border: 2px dashed var(--cinna-blue); }
        #dictation-input { width: 100%; border: none; font-size: 1.3rem; padding: 10px; text-align: center; border-bottom: 2px solid var(--cinna-blue); margin-bottom: 15px; outline: none; }
        .start-btn { background: var(--cinna-pink); color: white; border: none; padding: 18px; border-radius: 50px; font-weight: 900; font-size: 1.4rem; width: 100%; box-shadow: 0 5px 0 #f48fb1; cursor: pointer; }

        .hidden-mode { display: none; }
        .play-all-btn { background: #81d4fa; color: white; border: none; padding: 20px; border-radius: 50px; font-weight: 900; font-size: 1.3rem; width: 100%; margin-bottom: 25px; box-shadow: 0 5px 0 #4fc3f7; }

        .word-grid { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; min-height: 100px; }
        .word-tile { width: 65px; height: 65px; background: white; border: 3px solid var(--cinna-blue); border-radius: 18px; display: flex; align-items: center; justify-content: center; position: relative; }
        .tile-invisible { visibility: hidden; }

        .word-tile .char { font-size: 2.2rem; color: #546e7a; }
        .word-tile.completed { border-color: var(--cinna-pink); background: #fffaff; visibility: visible !important; }
        .word-tile.completed::after { content: 'ğŸ§'; position: absolute; top: -10px; right: -10px; font-size: 1.2rem; }

        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 1000; flex-direction: column; align-items: center; justify-content: center; }
        #writer-canvas { border: 4px solid #f0f0f0; border-radius: 25px; width: 320px; height: 320px; margin: 15px 0; background: #fff; }
        
        .action-btn { width: 85%; padding: 18px; border-radius: 20px; font-weight: bold; border: none; font-size: 1.3rem; margin-bottom: 10px; cursor: pointer; }
        .audio-btn { background: #e1f5fe; color: #0288d1; border: 2px solid #b3e5fc; }
        .quiz-btn { background: var(--cinna-pink); color: white; box-shadow: 0 6px 0 #f06292; font-size: 1.5rem; }
    </style>
</head>
<body>

    <div class="header">
        <div class="hero-img"></div>
        <h3 style="margin:5px 0; color: #78909c;">ç‰æ¡‚ç‹—é»˜å¯«ç‰¹è¨“</h3>
    </div>

    <div id="setup-ui">
        <div class="mode-selector">
            <button class="mode-btn active" id="m1-btn" onclick="selectLevel(1)">Level 1 (é›²æœµæç¤º)</button>
            <button class="mode-btn" id="m2-btn" onclick="selectLevel(2)">Level 2 (å…¨ç›²é»˜)</button>
        </div>
        <div class="input-panel">
            <input type="text" id="dictation-input" placeholder="éŒ„å…¥é»˜å¯«å¥å­..." />
            <button class="start-btn" onclick="startChallenge()">ğŸš€ é–‹å§‹é»˜å¯«æŒ‘æˆ°</button>
        </div>
    </div>

    <div id="challenge-ui" class="hidden-mode">
        <button class="play-all-btn" onclick="sayFull()">ğŸ”Š è½å…¨å¥æœ—è®€ (å»£æ±è©±)</button>
        <div class="word-grid" id="tile-grid"></div>
        <button onclick="location.reload()" style="margin-top:50px; background:none; border:none; color:#bbb; text-decoration:underline;">è¿”å›é‡æ–°éŒ„å…¥</button>
    </div>

    <div id="modal" class="modal">
        <div style="font-size: 1rem; color: #b3e5fc; font-weight: bold;">è«‹é»˜å¯«ç¬¬ <span id="char-idx">1</span> å€‹å­—</div>
        <div id="writer-canvas"></div>
        <button class="action-btn audio-btn" onclick="sayChar()">ğŸ”Š è½è®€éŸ³</button>
        <button class="action-btn quiz-btn" onclick="goQuiz()">âœï¸ æˆ‘æº–å‚™å¥½é»˜å¯«äº†</button>
    </div>

    <script>
        let currentLevel = 1;
        let writer = null;
        let activeChar = '';
        let currentIndex = 0;
        let allChars = [];

        function selectLevel(l) {
            currentLevel = l;
            document.getElementById('m1-btn').classList.toggle('active', l===1);
            document.getElementById('m2-btn').classList.toggle('active', l===2);
        }

        function startChallenge() {
            const text = document.getElementById('dictation-input').value.trim();
            if(!text) return;
            allChars = text.split('');
            document.getElementById('setup-ui').classList.add('hidden-mode');
            document.getElementById('challenge-ui').classList.remove('hidden-mode');
            
            renderGrid();
            if(currentLevel === 2) { currentIndex = 0; autoNextLvl2(); }
        }

        function renderGrid() {
            const grid = document.getElementById('tile-grid');
            grid.innerHTML = '';
            allChars.forEach((char, i) => {
                const tile = document.createElement('div');
                tile.className = 'word-tile';
                tile.id = `tile-${i}`;
                if (/[ï¼Œã€‚ï¼ï¼Ÿã€\s]/.test(char)) {
                    tile.innerHTML = `<span class="char" style="color:#ddd">${char}</span>`;
                    tile.style.border = "none";
                } else {
                    tile.innerHTML = `<span class="char">${char}</span>`;
                    if(currentLevel === 1) {
                        const cloud = document.createElement('div');
                        cloud.innerText = 'â˜ï¸';
                        cloud.style.cssText = 'position:absolute; background:white; width:100%; height:100%; display:flex; align-items:center; justify-content:center; border-radius:15px;';
                        tile.appendChild(cloud);
                        tile.onclick = () => openModal(char, i);
                    } else {
                        tile.classList.add('tile-invisible');
                    }
                }
                grid.appendChild(tile);
            });
        }

        function autoNextLvl2() {
            while(currentIndex < allChars.length && /[ï¼Œã€‚ï¼ï¼Ÿã€\s]/.test(allChars[currentIndex])) currentIndex++;
            if(currentIndex < allChars.length) openModal(allChars[currentIndex], currentIndex);
            else alert("ğŸ¬ æ­å–œï¼å…¨å¥é»˜å¯«å®Œæˆï¼");
        }

        function openModal(char, index) {
            activeChar = char; currentIndex = index;
            document.getElementById('modal').style.display = 'flex';
            document.getElementById('writer-canvas').innerHTML = '';
            document.getElementById('char-idx').innerText = index + 1;
            
            writer = HanziWriter.create('writer-canvas', char, {
                width: 320, height: 320, padding: 30,
                showOutline: false, showCharacter: false, // çµ•å°ç™½ç´™æ¨¡å¼
                drawingWidth: 35, strokeColor: '#444'
            });
            sayChar();
        }

        function goQuiz() {
            writer.quiz({
                onComplete: () => {
                    const tile = document.getElementById(`tile-${currentIndex}`);
                    tile.classList.add('completed');
                    if (tile.querySelector('div')) tile.querySelector('div').remove();
                    setTimeout(() => {
                        document.getElementById('modal').style.display = 'none';
                        if(currentLevel === 2) { currentIndex++; autoNextLvl2(); }
                    }, 800);
                }
            });
        }

        function sayFull() {
            const u = new SpeechSynthesisUtterance(allChars.join(''));
            u.lang = 'zh-HK'; u.rate = 0.7;
            window.speechSynthesis.speak(u);
        }

        function sayChar() {
            const u = new SpeechSynthesisUtterance(activeChar);
            u.lang = 'zh-HK'; window.speechSynthesis.speak(u);
        }
    </script>
</body>
</html>
